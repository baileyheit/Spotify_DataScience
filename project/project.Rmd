---
title: "Project Proposal: What Makes a Song Popular on Spotify?"
author: "CCBK"
date: "3/21/18"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(infer)
library(broom)
```

```{r load-data}
songs_complete <- read_csv("/cloud/project/data/SpotifyFeatures.csv")
songs <- sample_n(songs_complete, 5000, replace = FALSE)

write.csv(songs,"/cloud/project/data/songsc.csv", row.names = FALSE)

songs
```

songs
```

### Introduction

### Visualization

Relationship Between Different Variables and Song Popularity

```{r plot-genre-popularity, fig.width=15, fig.width=15}
ggplot(data = songs, mapping = aes(x = genre, y = popularity)) +
  geom_boxplot() +
  labs(title = "Genre v. Popularity of Songs", x = "Genre", y = "Popularity")
```

```{r plot-acousticness-popularity}
ggplot(data = songs, mapping = aes(x = acousticness, y = popularity, alpha = 0.005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Acousticness v. Popularity of Songs", x = "Acousticness", y = "Popularity")
```


```{r plot-energy-popularity}
ggplot(data = songs, mapping = aes(x = energy, y = popularity, alpha = 0.0005)) +
  geom_point() +
  geom_smooth() +
  labs(title = "Energy v. Popularity of Songs", x = "Energy", y = "Popularity")
```

```{r plot-danceability-popularity}
ggplot(data = songs, mapping = aes(x = danceability, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Danceability v. Popularity of Songs", x = "Danceability", y = "Popularity")
```

```{r plotg-duration-popularity}
songs_duration <- songs %>%
  mutate(duration_s = duration_ms/1000) %>%
  filter(duration_s <= 800)

ggplot(data = songs_duration, mapping = aes(x = duration_s, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Duration v. Popularity of Songs", x = "Duration", y = "Popularity")
```

```{r plot-instrumentalness-popularity}
ggplot(data = songs, mapping = aes(x = instrumentalness, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Instrumentalness v. Popularity of Songs", x = "Instrumentalness", y = "Popularity")
```


```{r plot-key-popularity}
ggplot(data = songs, mapping = aes(x = key, y = popularity)) +
  geom_boxplot() +
  labs(title = "Key v. Popularity of Songs", x = "Key", y = "Popularity")
```


```{r plot-liveness-popularity}
ggplot(data = songs, mapping = aes(x = liveness, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Liveness v. Popularity of Songs", x = "Liveness", y = "Popularity")
```

```{r plot-loudness-popularity}
songs_loudness <- songs %>%
  filter(loudness >= -30)

ggplot(data = songs_loudness, mapping = aes(x = loudness, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Loudness v. Popularity of Songs", x = "Loudness", y = "Popularity")
```

```{r plot-mode-popularity}
ggplot(data = songs, mapping = aes(x = mode, y = popularity)) +
  geom_boxplot() +
  labs(title = "Mode v. Popularity of Songs", x = "Mode", y = "Popularity")
```

```{r plot-speechiness-popularity}
ggplot(data = songs, mapping = aes(x = speechiness, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Speechiness v. Popularity of Songs", x = "Speechiness", y = "Popularity")
```

```{r plot-tempo-popularity}
ggplot(data = songs, mapping = aes(x = tempo, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Tempo v. Popularity of Songs", x = "Tempo", y = "Popularity")
```

```{r timesignature-popularity}
ggplot(data = songs, mapping = aes(x = time_signature, y = popularity)) +
  geom_boxplot() +
  labs(title = "Time Signature v. Popularity of Songs", x = "Time Signature", y = "Popularity")
```


```{r plot-valence-popularity}
ggplot(data = songs, mapping = aes(x = valence, y = popularity, alpha = 0.0005)) +
  geom_point() + 
  geom_smooth() +
  labs(title = "Valence v. Popularity of Songs", x = "Valence", y = "Popularity")
```



### Data Wrangling
### Linear Regression
```{r full-model}

full_model = lm(popularity ~ acousticness +
                  danceability +
                  energy +
                  instrumentalness +
                  liveness +
                  loudness +
                  speechiness + 
                  tempo + 
                  valence +
                  loudness * liveness,
                data = songs)

full_model

glance(full_model)$r.squared
glance(full_model)$adj.r.squared
```


```{r selected-model}

selected_model <- step(full_model, direction = "backward")

selected_model

glance(selected_model)$r.squared
glance(selected_model)$adj.r.squared
```

score_hat = 56.20 + -11.30 * acousticness + 17.19 * danceability - 5.933 * energy - 4.11 * instrumentalness + -6.40 * liveness + 0.60 * loudness + -10.36 * speechiness + -8.25 * valence + 0.62 * liveness:loudness

When all variables have a value of 0, then it is expected that a song's populariy is 56.20 One example of how a variable influences the popularity is with acousticness. If a song's acoustic score increases by 1 then popularity will on average decrease by 11.30 points, all else held constant. There is also an apparent interaction between danceability and energy. When the interaction increases by one on average the popularity decreases by 12.96 points, all else held constant. 

The adjusted R squared value for this model is 0.289, which means that roughly 28.9% of the variability in a song's popularity can be explained by the different variables in the multiple regression model. This indicates that there is a weak to moderate positive overall realtionship between a song's popularity and the different variables related to a song.


```{r mode-model}

mode_model = lm(popularity ~ mode, data = songs)

mode_model

glance(mode_model)$r.squared
```

score_hat = 43.77 + 2.007 * mode_minor

Minor equation: 
score_hat = 43.77 + 2.007 * 1 
          = 45.77

Major equestion:
score_hat = 43.77 + 2.007 * 0
          = 43.77
          
  Songs that are in the major mode tent to have higher popularity scores than songs in a minor key. All else held constant, theere is an expected popularity score increase of 2.007 if the song is in the minor key compared to the major key. 

```{r energy-model}

energy_model = lm(popularity ~ energy, data = songs)

energy_model

glance(energy_model)$r.squared
```

```{r danceability-model}

danceability_model = lm(popularity ~ danceability, data = songs)

danceability_model

glance(danceability_model)$r.squared
```

```{r liveness-model}

liveness_model = lm(popularity ~ liveness, data = songs)

liveness_model

glance(liveness_model)$r.squared
```

```{r acoustiness-model}

liveness_model = lm(popularity ~ liveness, data = songs)

liveness_model

glance(liveness_model)$r.squared
```

### Bootstrapping

### Conclusion

Your project goes here! Before you submit, make sure your chunks are turned off with `echo = FALSE`. 

You can add sections as you see fit. Make sure you have a section called Introduction at the beginning and a section called Conclusion at the end. The rest is up to you!