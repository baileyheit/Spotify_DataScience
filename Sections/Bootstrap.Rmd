---
title: "Bootstrap"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(infer)
library(broom)
songs_complete <- read_csv("/cloud/project/data/SpotifyFeatures.csv")
songs <- sample_n(songs_complete, 5000, replace = FALSE)
```

```{r setseed}
set.seed(1234)
```

### Bootstrapping to find confidence intervals

In this section, bootstrapping was used to determine the confidence intervals for the difference in mean popularity scores between different categories within variables. For example, the confidence interval for the difference in mean popularity scores between the Rap and Pop genres (the most popular 2 genres) were calculated. 

### Genre 

```{r rap_pop}

songs_gen <- songs %>%
  filter(genre == "Rap"|genre == "Pop")

boot_rap_pop <- songs_gen %>%
   specify(response = popularity, explanatory = genre) %>%
   generate(reps = 100, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("Pop", "Rap"))

ggplot(data = boot_rap_pop, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "Pop - Rap", x = "Difference in Popularity")
```

```{r conf_rap_pop}
lower_bound <- boot_rap_pop %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound
upper_bound <- boot_rap_pop %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound
```
We are 95% certain that the difference in means between the popularity score of the rap and pop genres is between `r lower_bound` and `r upper_bound`. 

### Time Signature

From the boxplot in the visualizations section, we can see that the 4/4 time signature had a higher average population score than the rest of the time signatures. Thus, we decided to construct a confidence interval estimating the difference in popularity means between songs with a 4/4 time signature and songs that do not use a 4/4 time signature. 

```{r time_signature_new}
   
time_signature_songs <- songs %>%
   mutate(time_signatureHL = case_when(
    time_signature == "4/4" ~ "4/4",
    TRUE ~ "Not 4/4")) %>%
   filter(! is.na(time_signatureHL))

time_signature_songs %>%
   group_by(time_signatureHL) %>%
   summarise(average = mean(popularity))
```
We can see that songs with 4/4 time signature have an average popularity score that is around 10 higher than songs that do not have a 4/4 time signature. 

```{r time_signature_boot}

boot_time_signature <- time_signature_songs %>%
   specify(response = popularity, explanatory = time_signatureHL) %>%
   generate(reps = 1000, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("4/4", "Not 4/4"))

ggplot(data = boot_time_signature, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "4/4 - Not 4/4", x = "Difference in Popularity")
```

```{r conf_time_signature}
lower_bound0 <- boot_time_signature %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound0
upper_bound0 <- boot_time_signature %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound0
```
We are 95% certain that the difference in popularity means between the songs with higher (highest 25%) time_signature and the lower (lowest 25%) time_signature is between `r lower_bound0` and `r upper_bound0`.

### Confidence intervals for continous variables

The following variables were selected because the visualizations showed that they had the strongest linear relationships with popularity scores. The variables that were chosen are: danceability, energy, liveness, loudness, and acousticness. 

For each of these variables, we took the highest 25% of the data ("High" danceability, energy, liveness etc.) and the lowest 25% of the data ("Low" danceability, energy, liveness etc.) and conducted a 95% confidence interval test for the difference in mean popularities between the two. 

### Danceability

```{r dance_info}
songs %>%
   summarise(max = max(danceability), min = min(danceability), q1 = quantile(danceability, probs = 0.25), q3 = quantile(danceability, probs = 0.75))

```

```{r dance_new}
dance_songs <- songs %>%
   mutate(danceHL = case_when(
    danceability >= 0.437 ~ "High",
    danceability <= 0.69 ~ "Low"))

dance_songs %>%
   group_by(danceHL) %>%
   summarise(average = mean(popularity))
```
Songs with high danceability have a mean popularity score that is around 10 higher compared songs with low danceability. 

```{r dance_boot}

boot_dance <- dance_songs %>%
   specify(response = popularity, explanatory = danceHL) %>%
   generate(reps = 1000, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("High", "Low"))

ggplot(data = boot_dance, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "High - Low", x = "Difference in Popularity")
```

```{r conf_dance}
lower_bound1 <- boot_dance %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound1
upper_bound1 <- boot_dance %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound1
```
We are 95% certain that the difference in popularity means between the songs with high danceability and low danceability is between `r lower_bound1` and `r upper_bound1`.

### Energy 

```{r energy_info}
songs %>%
   summarise(max = max(energy), min = min(energy), q1 = quantile(energy, probs = 0.25), q3 = quantile(energy, probs = 0.75))

```

```{r energy_new}
   
energy_songs <- songs %>%
   mutate(energyHL = case_when(
    energy >= 0.793 ~ "High",
    energy <= 0.405 ~ "Low")) %>%
   filter(! is.na(energyHL))

energy_songs %>%
   group_by(energyHL) %>%
   summarise(average = mean(popularity))
```
Songs with high energy have a mean popularity score that is around 10 higher compared songs with low energy. 

```{r energy_boot}

boot_energy <- energy_songs %>%
   specify(response = popularity, explanatory = energyHL) %>%
   generate(reps = 1000, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("High", "Low"))

ggplot(data = boot_energy, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "High - Low", x = "Difference in Popularity")
```

```{r conf_energy}
lower_bound2 <- boot_energy %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound2
upper_bound2 <- boot_energy %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound2
```
We are 95% certain that the difference in means between songs with high  energy and low energy is between `r lower_bound2` and `r upper_bound2`.

### Liveness

```{r liveness_info}
songs %>%
   summarise(max = max(liveness), min = min(liveness), q1 = quantile(liveness, probs = 0.25), q3 = quantile(liveness, probs = 0.75))

```

```{r liveness_new}
   
liveness_songs <- songs %>%
   mutate(livenessHL = case_when(
    liveness >= 0.266 ~ "High",
    liveness <= 0.098 ~ "Low")) %>%
   filter(! is.na(livenessHL))

liveness_songs %>%
   group_by(livenessHL) %>%
   summarise(average = mean(popularity))
```
Songs with high liveness (chances of having been performed live) have a mean popularity score that is around 6 lower compared songs with low liveness. 

```{r liveness_boot}

boot_liveness <- liveness_songs %>%
   specify(response = popularity, explanatory = livenessHL) %>%
   generate(reps = 1000, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("High", "Low"))

ggplot(data = boot_liveness, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "High Liveness - Low Liveness", x = "Difference in Popularity")
```

```{r conf_liveness}
lower_bound3 <- boot_liveness %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound3
upper_bound3 <- boot_liveness %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound3
```
We are 95% certain that the difference in popularity means between songs with high liveness and low liveness is between`r lower_bound3` and `r upper_bound3`.

### Loudness 

```{r loudness_info}
songs %>%
   summarise(max = max(loudness), min = min(loudness), q1 = quantile(loudness, probs = 0.25), q3 = quantile(loudness, probs = 0.75))

```

```{r loudness_new}
   
loudness_songs <- songs %>%
   mutate(loudnessHL = case_when(
    loudness >= -5.36 ~ "High",
    loudness <= -11.34 ~ "Low")) %>%
   filter(! is.na(loudnessHL))

loudness_songs %>%
   group_by(loudnessHL) %>%
   summarise(average = mean(popularity))
```
Songs with high loudness have a mean popularity score that is around 18 higher compared with songs with low loudness. 

```{r loudness_boot}

boot_loudness <- loudness_songs %>%
   specify(response = popularity, explanatory = loudnessHL) %>%
   generate(reps = 1000, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("High", "Low"))

ggplot(data = boot_loudness, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "High Loudness - Low Loudness", x = "Difference in Popularity")
```

```{r conf_loudness}
lower_bound4 <- boot_loudness %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound4
upper_bound4 <- boot_loudness %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound4
```
We are 95% certain that the difference in mean popularity scores between songs with high loudness and the low loudness is between `r lower_bound4` and `r upper_bound4`.

### Acousticness 

```{r acousticness_info}
songs %>%
   summarise(max = max(acousticness), min = min(acousticness), q1 = quantile(acousticness, probs = 0.25), q3 = quantile(acousticness, probs = 0.75))

```

```{r acousticness_new}
   
acousticness_songs <- songs %>%
   mutate(acousticnessHL = case_when(
    acousticness >= 0.703 ~ "High",
    acousticness <= 0.0303 ~ "Low")) %>%
   filter(! is.na(acousticnessHL))

acousticness_songs %>%
   group_by(acousticnessHL) %>%
   summarise(average = mean(popularity))
```
Songs with high acousticness have a mean popularity score that is around 18 lower compared songs with low acousticness. 

```{r acousticness_boot}

boot_acousticness <- acousticness_songs %>%
   specify(response = popularity, explanatory = acousticnessHL) %>%
   generate(reps = 1000, type = "bootstrap") %>%
   calculate(stat = "diff in means", order = c("High", "Low"))

ggplot(data = boot_acousticness, mapping = aes(x=stat)) + geom_histogram() + labs(title = "Bootstrap Distribution of Difference in Mean Popularity", subtitle = "High Acousticness - Low Acousticness", x = "Difference in Popularity")
```

```{r conf_acousticness}
lower_bound5 <- boot_acousticness %>%
  summarize(lower_bound = quantile(stat, 0.025))
lower_bound5
upper_bound5 <- boot_acousticness %>%
  summarize(upper_bound = quantile(stat, 0.975))
upper_bound5
```
We are 95% certain that the difference in popularity means between songs with high  acousticness and the low acousticness is between `r lower_bound5` and `r upper_bound5`.

